#!/usr/bin/env bash

set -e

__dockerCommand='docker run --rm'

IMAGE_REGISTRY=mw-docker.repositories.mathworks.com
IMAGE_NAME=go-docker-base
IMAGE_TAG=latest

__dockerImage="${IMAGE_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"

if [[ -n "${GH_SSH_KEY}" ]] || [[ -n "${GH_SSH_KEY_FILE}" ]]; then
    __dockerSSHMountFlags="--volume \"${SSH_AUTH_SOCK_MOUNT}\":/tmp/ssh-auth.sock --env SSH_AUTH_SOCK=/tmp/ssh-auth.sock"

    ./build/package/scripts/ssh-agent-entrypoint.sh \
        "${__dockerCommand}" \
        "${__dockerSSHMountFlags}" \
        "${__dockerImage}" \
        "${@}"
else
    eval "${__dockerCommand} ${__dockerImage} ${@}"
fi
